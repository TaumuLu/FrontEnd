<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../../../JavaScript/jQuery/jquery-1.11.3.js" type="text/javascript"></script>
    <title>带有分散效果的瀑布流</title>
    <style type="text/css">
    * {
        padding: 0;
        margin: 0;
    }
    #main {
        position: relative;
    }
    .pin {
        padding: 15px 0 0 15px;
        float: left;
    }
    .box {
        padding: 10px;
        border: 1px solid #ccc;
        box-shadow: 0 0 6px #ccc;
        border-radius: 5px;
    }
    .box img {
        width: 162px;
        height: auto;
    }
    </style>

    <script>

    $(window).on("load", function() {
        // 调用waterfall函数
        waterfall('main','pin');
        var dataInt = {
            'data': [{
                'src': '01.jpg'
            }, {
                'src': '02.jpg'
            }]
        };
        $(window).on('scroll',function(){
            // 拖动滚动条时
            if(checkscrollside){
                $.each(dataInt.data,function(key,value){
                    var oBox=$('<div>').addClass('box').appendTo($('#main'));
                    var oPin=$('<div>').addClass('pin').appendTo($(oBox));
                    $('<img>').attr('src','../../../images/'+$(value).attr('src')).appendTo($(oPin));
                })
                waterfall();
            }
        })
    });

    function waterfall(main,pin) {
        // 计算及定位数据块显示分散效果
        var $boxs=$("#main>div");
        var w=$boxs.eq(0).outerWidth();
        var cols=Math.floor($(window).width()/w);
        $('#main').width(w*cols).css('margin','0 auto');
        var hArr=[];
        $boxs.each(function(index,value){
            var h=$boxs.eq(index).outerHeight();
            if(index<cols){
                hArr[index]=h;
            }else{
                var minH=Math.min.apply(null,hArr);
                var minHindex=$.inArray(minH,hArr);
                $(value).css({
                    'position':'absolute',
                    'top':minH+'px',
                    'left':minHindex*w+'px'
                })
                hArr[minHindex]+=$boxs.eq(index).outerHeight();
            }
        })
    }

    function checkscrollside() {
        // 检测是否具备了加载数据块的条件
        var $lastBox=$('#main>diov').last;
        var lastBoxDis=$lastBox.offset().top+Math.floor($lastBox.outerHeight()/2);
        var scrollTop=$(window).scrollTop();
        var documentH=$(window).height();
        return (lastBoxDis<scrollTop+documentH)?true:false;
    }

    </script>
</head>
<body>
    <div id="main">
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/01.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="../../../images/02.jpg"/>
            </div>
        </div>
    </div>
</body>
</html>
